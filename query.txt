-- create table
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT,
    category TEXT
);
INSERT INTO users (name, category) VALUES ('Student1', 'User'), ('Student2', 'User'), ('Student3', 'User');

INSERT INTO users (name, category) VALUES ('Librarian 1', 'Librarian'), ('Librarian 2', 'Librarian'), ('Librarian 3', 'Librarian');

INSERT INTO users (name, category) VALUES ('Ajay', 'User'), ('Amir', 'User'), ('Abhay', 'User'), ('Amit', 'User'), ('Amarnath', 'User'), ('Amitabhh', 'User');

CREATE TABLE libraby_accounts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    student_id INTEGER,
    librarian_id INTEGER
);

INSERT INTO libraby_accounts (student_id, librarian_id) values (10, 9), (11, 9), (12, 8), (13, 8), (14, 7), (15, 7);

CREATE TABLE librabry_books_taken (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    account_id INTEGER,
    book_name TEXT,
    type TEXT
);

INSERT INTO librabry_books_taken (account_id, book_name, type) values (1, "Gone with the wind", "fiction"), (1, "Book name 1", "fiction"), (1, "Ali Baba", "fiction");

INSERT INTO librabry_books_taken (account_id, book_name, type) values (1, "Homer", "fiction"), (1, "Book name 3", "fiction"), (1, "Book name 4", "fiction");

INSERT INTO librabry_books_taken (account_id, book_name, type) values (1, "50 Ghosts", "horror"), (1, "Myth and Urban Length of India", "horror"), (1, "Bhootnath the Horror", "horror");

INSERT INTO librabry_books_taken (account_id, book_name, type) values (1, "13 Men in Jungle", "horror"), (1, "Urban Length of Rural India", "horror"), (1, "Dyne of Forest", "horror");

SELECT u.name AS user_name, 
       u2.name AS librarian_name
FROM libraby_accounts la
JOIN librabry_books_taken lbt ON la.id = lbt.account_id
JOIN users u ON la.student_id = u.id
JOIN users u2 ON la.librarian_id = u2.id
WHERE u.name LIKE 'A%' AND LENGTH(u.name) <= 7
GROUP BY u.name, u2.name
HAVING SUM(lbt.type = 'horror') > 5 AND SUM(lbt.type = 'fiction') < 6;

select * from users where name like "A%" and LENGTH(name) <= 7;

select u1.name as user_name, u2.name as librarian
from libraby_accounts la 
JOIN librabry_books_taken lbt ON la.id = lbt.account_id
JOIN users u1 ON la.student_id = u1.id
JOIN users u2 ON la.librarian_id = u2.id 
WHERE u1.name LIKE 'A%' AND LENGTH(u1.name) <= 7
GROUP BY u1.name, u2.name 
HAVING SUM(lbt.type = 'horror') > 5 AND SUM(lbt.type = 'fiction') < 6; ;



select * from librabry_books_taken group by id having sum(type="horror")>0;

update librabry_books_taken set type="horror" where id >=5 and id <=6;


INSERT INTO librabry_books_taken (account_id, book_name, type) values (2, "Gone with the wind", "fiction"), (2, "Book name 1", "fiction"), (2, "Ali Baba", "fiction");

INSERT INTO librabry_books_taken (account_id, book_name, type) values (2, "Homer", "fiction"), (2, "Book name 3", "fiction"), (2, "Book name 4", "fiction");

INSERT INTO librabry_books_taken (account_id, book_name, type) values (2, "50 Ghosts", "horror"), (2, "Myth and Urban Length of India", "horror"), (2, "Bhootnath the Horror", "horror");

INSERT INTO librabry_books_taken (account_id, book_name, type) values (2, "13 Men in Jungle", "horror"), (2, "Urban Length of Rural India", "horror"), (2, "Dyne of Forest", "horror");

INSERT INTO libraby_accounts (student_id, librarian_id) values (4, 7);

INSERT INTO librabry_books_taken (account_id, book_name, type) values (7, "Me and Her", "fiction"), (7, "Girl with Book", "fiction"), (7, "Adventure of Raju", "fiction");
